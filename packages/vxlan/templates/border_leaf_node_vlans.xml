<config-template xmlns="http://tail-f.com/ns/config/1.0">
    <devices xmlns="http://tail-f.com/ns/ncs">
        <device>
            <name>{$DEVICE-NAME}</name>
            <config>

               <interface xmlns="http://tail-f.com/ned/cisco-nx" when="{boolean(members)}">
                    <port-channel>
                        <name>{$DCI_PORT}</name>
                        <switchport>
                            <trunk>
                                <allowed>
                                    <vlan>
                                        <ids>{$DCI_VLAN}</ids>
                                    </vlan>
                                </allowed>
                            </trunk>
                        </switchport>
                    </port-channel>
                    <Ethernet foreach="{members/Ethernet}">
                        <name>{string(member-id)}</name>
                        <switchport>
                            <trunk>
                                <allowed>
                                    <vlan>
                                        <ids>{$DCI_VLAN}</ids>
                                    </vlan>
                                </allowed>
                            </trunk>
                        </switchport>
                    </Ethernet>
                </interface>

                <interface xmlns="http://tail-f.com/ned/cisco-nx" when="{not(boolean(members))}">
                    <Ethernet>
                        <name>{$DCI_PORT}</name>
                        <switchport>
                            <trunk>
                                <allowed>
                                    <vlan>
                                        <ids>{$DCI_VLAN}</ids>
                                    </vlan>
                                </allowed>
                            </trunk>
                        </switchport>
                    </Ethernet>
                </interface>

            </config>
        </device>
    </devices>
</config-template>
